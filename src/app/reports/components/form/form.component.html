<p-confirmDialog #cd [style]="{width: '50vw'}" key="newTabConfirmation">
  <ng-template pTemplate="header">
      <h3>Confirmación</h3>
  </ng-template>
  <ng-template pTemplate="footer">
      <button type="button" pButton icon="pi pi-times" label="No" (click)="cd.reject()"></button>
      <button type="button" pButton icon="pi pi-check" label="Si" (click)="cd.accept()"></button>
  </ng-template>
</p-confirmDialog>
<p-card>
  <ng-template pTemplate="header">
    <span class="d-block p-2 text-white">
      <i class="fas fa-chart-bar" style="margin-right: 0.5rem;"></i>Panel de Reportes</span>
  </ng-template>
    <div class="p-fluid y-form-container" style="font-size: 0.9rem;">
      <div class="row">
        <div class="p-field">
          <label class="bg-subtitle">Reporte :</label>
          <p-dropdown [options]="reports" [(ngModel)]="selectedReport" optionLabel="value" optionValue="id" [showClear]="false" placeholder="Seleccione el reporte..." (onChange)="changedReport(); validateForm();"></p-dropdown>
        </div>
      </div>
      <div class="row">
        <div class="col-6">
          <div class="p-field">
            <label class="bg-subtitle" id="vehicle_label">Vehículos:</label>
            <p-multiSelect [options]="vehicles" [(ngModel)]="selectedVehicles" optionLabel="name" [showToggleAll]="false"f placeholder="Seleccione..." (onChange)="onSelectedVehiclesChange(); validateForm();"></p-multiSelect>
            <div style="padding: 0px 0.3rem; margin: 0px; text-align: right;">
              <label>
                <p-checkbox [(ngModel)]="chkAllVehicles" [binary]="true" inputId="binary" (onChange)="selectAllVehicles(); validateForm();"></p-checkbox>
                Todos
              </label>
            </div>
            
          </div>
        </div>
        <div class="col-6">
          <div class="p-field">
            <button class="bg-subtitle btn-toggle-option btn-toggle-left" [ngClass]="!checkboxGroup? '': 'disabled'" (click)="checkboxGroup = false; onSelectedConvoyChange(); validateForm();">Convoy</button>
            <button class="bg-subtitle btn-toggle-option btn-toggle-right" [ngClass]="checkboxGroup? '': 'disabled'" (click)="checkboxGroup = true; onSelectedGroupChange(); validateForm();">Grupo</button>
            <p-dropdown *ngIf="!checkboxGroup" [options]="convoys" [(ngModel)]="selectedConvoy" [showClear]="false" placeholder="Seleccione convoy..." (onChange)="onSelectedConvoyChange(); validateForm();"></p-dropdown>
            <p-dropdown *ngIf="checkboxGroup" [options]="groups" [(ngModel)]="selectedGroup" [showClear]="false" placeholder="Seleccione grupo..." (onChange)="onSelectedGroupChange(); validateForm();"></p-dropdown>
          </div>
        </div>
      </div>
      
      <div class="row">
        <ng-container>
          <div class="col-6">
            <label>
              <p-checkbox name="groupname" [binary]="true" [(ngModel)]="chkDateHour" (onChange)="onChkDateHourChange();">Fecha/Hora</p-checkbox>
              Fecha/Hora</label>
          </div>
          <div class="col-6">
            <!-- <div class="p-field">
              <label>
                <p-checkbox name="groupname" [(ngModel)]="checkboxGroup" [binary]="true" inputId="binary" (onChange)="validateForm();"></p-checkbox>
                Grupo</label>
            </div> -->
          </div>     
        </ng-container>
        <ng-container *ngIf="showMovStop">
          <div class="col-6">
            <div class="p-field">
              <label>
                <p-checkbox [(ngModel)]="chkStops" [binary]="true" inputId="binary" (onChange)="validateForm();"></p-checkbox>
              Paradas</label>
            </div>
          </div>
          <div class="col-6">
            <div class="p-field">
              <label>
                <p-checkbox [(ngModel)]="chkMovements" [binary]="true" inputId="binary" (onChange)="validateForm();"></p-checkbox>
              Movimientos</label>
            </div>
          </div>            
        </ng-container>
        <ng-container *ngIf="showBrakeAccel">
          <div class="col-6">
            <div class="p-field">
              <label>
                <p-checkbox [(ngModel)]="chkFrenada" [binary]="true" inputId="binary" (onChange)="validateForm();"></p-checkbox>
              Frenada</label>
            </div>
          </div>
          <div class="col-6">
            <div class="p-field">
              <label>
                <p-checkbox [(ngModel)]="chkAceleracion" [binary]="true" inputId="binary" (onChange)="validateForm();"></p-checkbox>
              Aceleracion</label>
            </div>
          </div>            
        </ng-container>
        
      </div>

      <ng-container *ngIf="showExcVelOpt">
        <div class="row">
          <div class="col-6">
            <div class="p-field">
              <p-radioButton name="exVe" value="limVel" label="Límite de Velocidad" [(ngModel)]="excesoVelocidad" (onClick)="showExcVel();"></p-radioButton>
            </div>
          </div>
          <div class="col-6">
            <div class="p-field">
              <p-radioButton name="exVe" value="durExc" label="Duración" [(ngModel)]="excesoVelocidad" (onClick)="showExcVel();"></p-radioButton>
            </div>
          </div>
        </div>   
      </ng-container>
      <ng-container *ngIf="showOdomOpt">
        <div class="row">
          <div class="col-6">
            <div class="p-field">
              <p-radioButton name="odomV" value="0" label="Odómetro" [(ngModel)]="odometroVirtual"></p-radioButton>
            </div>
          </div>
          <div class="col-6">
            <div class="p-field">
              <p-radioButton name="odomV" value="1" label="Odómetro Virtual" [(ngModel)]="odometroVirtual"></p-radioButton>
            </div>
          </div>
        </div>  
      </ng-container>
      
      <div *ngIf="showExcVelOpt">
        <div class="row">
          <div class="col-6">
            <div class="p-field" *ngIf="excesoVelocidad == 'limVel'">
              <label class="bg-subtitle" for="limiteVelocidad">Límite de velocidad</label>
              <p-inputNumber [(ngModel)]="limitSpeed" [showButtons]="true" [min]="0" [max]="300" inputId="limiteVelocidad"></p-inputNumber>
            </div>
          </div>
          <div class="col-6">
            <div class="p-field" *ngIf="excesoVelocidad == 'durExc'">
              <label class="bg-subtitle" for="minimaDuracion">Duración</label>
              <p-inputNumber [(ngModel)]="minimDur" [showButtons]="true" [min]="0" suffix=" seg" inputId="minimaDuracion"></p-inputNumber>
            </div>
          </div>
        </div>
      </div>
      <div class="row" *ngIf="showLimitTime">
        <div class="col-12">
          <label class="bg-subtitle">Límite de tiempo:</label>
        </div>
        <div class="col-6">
          <div class="row">
            <div class="p-field">
              <label>Fecha inicio:
                <p-calendar [(ngModel)]="dateInit" dateFormat="dd/mm/yy" [maxDate]="dateEnd" (onSelect)="validateForm(); onTimeChange();"></p-calendar>
              </label>
            </div>
          </div>
          <div class="row">
            <div class="p-field">
              <label>Hora inicio:
                <p-calendar [(ngModel)]="timeInit" [timeOnly]="true" [readonlyInput]="true" [maxDate]="timeEnd" (onSelect)="validateForm(); onTimeChange();"></p-calendar>
              </label>
            </div>
          </div>
        </div>
        <div class="col-6">
          <div class="row">
            <div class="p-field">
              <label>Fecha final:
                <p-calendar [(ngModel)]="dateEnd" dateFormat="dd/mm/yy" [minDate]="dateInit" (onSelect)="validateForm(); onTimeChange();"></p-calendar>
              </label>
            </div>
          </div>
          <div class="row">
            <div class="p-field">
              <label>Hora final:
                <p-calendar [(ngModel)]="timeEnd" [timeOnly]="true" [readonlyInput]="true" [minDate]="timeInit" (onSelect)="validateForm(); onTimeChange();"></p-calendar>
              </label>
            </div>
          </div>
        </div>
      </div>
      <div class="row" *ngIf="showZones">
        <div class="p-field">
          <label>Geocercas :</label>
          <p-multiSelect [options]="zones.data" [(ngModel)]="selectedZones" optionLabel="zone_name" optionValue="id" placeholder="Seleccione la(s) geocerca(s)" (onChange)=" validateForm();"></p-multiSelect>
        </div>
      </div>
    </div>
    
  <ng-template pTemplate="footer">
    <button [disabled]="!isFormFilled" (click)="confirm()" pButton type="button" label="Generar Reporte"></button>

  </ng-template>
</p-card>
