<app-vehicle-config [display]="display" [config]="config" (eventDisplay)="onChangeDisplay($event)" (eventUpdate)="onUpdate($event)"></app-vehicle-config>
<p-dialog header="Descomponer" icon="pi pi-info-circle" [modal]="true" [style]="{width: '50vw'}" [(visible)]="displayDelete">
    Esta seguro de descomponer {{textDelete}}?
      <div class="" *ngIf="loadingDelete">
        <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
      </div>
    <ng-template *ngIf="loadingDelete==false" pTemplate="footer">
      <div [ngStyle]="{'display':buttonDisplay}" class="">
        <p-button icon="pi pi-check" (click)="onDelete()" label="Si" class="p-button-text"></p-button>
        <p-button icon="pi pi-times" (click)="displayDelete=false" label="No"></p-button>
      </div>
        </ng-template>
</p-dialog>
<p-dialog header="" icon="pi pi-info-circle" [style]="{width: '50vw'}" [(visible)]="displayEditGroup">
  <ng-template class="p-dialog-title" pTemplate="header">
    <strong>EDITAR {{textHeaderEdit}}</strong>
  </ng-template>
  <div class="p-fluid p-formgrid p-grid" style="font-size: 12px;">
    <div class="" *ngIf="loading">
      <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
    </div>

    <div class="" [ngStyle]="{'display':formDisplay}">
        <div class="row">
          <div class="col-6" >
            <h5>Ingrese nombre</h5>
              <span class="p-label">
                <label for="float-input">Nombre :</label>
                <input #nameEdit id="float-input" type="text" pInputText>
              </span>
              <!-- <span class="p-label">
                <label for="float-input">Descripcion :</label>
                <input #description id="float-input" type="text" pInputText>
              </span> -->
          </div>
        </div>
        <div class="row">
          <h5>Seleccione vehiculos</h5>
          <!-- <p-pickList [source]="list1" [target]="list2" [responsive]="true" [sourceStyle]="{'height':'200px'}" [targetStyle]="{'height':'200px'}"
            sourceFilterPlaceholder="Buscar por placa" targetFilterPlaceholder="Buscar por placa" filterBy="name">
              <ng-template let-car pTemplate="item">
                  <div>
                      <img border="0" width="25" height="25" src="assets/images/objects/nuevo/{{car.icon}}" style="display:inline-block;margin:2px 0 2px 2px">
                      <div style="font-size:12px;float:right;margin:5px 2px 0 0">{{car.name}}</div>
                  </div>
              </ng-template>
          </p-pickList> -->
          <div class="col-5">
            <p-listbox [options]="list1" [(ngModel)]="selectedList1" [multiple]="true" [checkbox]="true" [filter]="true" filterPlaceHolder="Buscar por placa" optionLabel="name" [listStyle]="{'max-height':'250px'}" [style]="{'width':'15rem'}">>
              <ng-template let-car pTemplate="item">
                  <div class="car-item">
                    <img border="0" width="25" height="25" src="assets/images/objects/nuevo/{{car.icon}}" style="display:inline-block;margin:2px 0 2px 2px">
                    <label>{{car.name}}</label>
                  </div>
              </ng-template>
            </p-listbox>
  <!-- <p-listbox [options]="list1" [(ngModel)]="selectedList1" optionLabel="name"></p-listbox> -->
          </div>
          <div class="col-2">
            <div class="">
              <button (click)="upList2()" type="button" class="btn btn-success" name="button">
                <span>
                  <i class="fa fa-angle-right"></i>
                </span>
              </button>
            </div>
            <br>
            <div class="">
              <button (click)="upList1()" type="button" class="btn btn-success" name="button">
                <span>
                  <i class="fa fa-angle-left"></i>
                </span>
              </button>
            </div>
          </div>
          <div class="col-5">
            <p-listbox [options]="list2" [(ngModel)]="selectedList2" [multiple]="true" [checkbox]="true" [filter]="true" filterPlaceHolder="Buscar por placa" optionLabel="name" [listStyle]="{'max-height':'250px'}" [style]="{'width':'15rem'}">>
              <ng-template let-car pTemplate="item">
                  <div class="car-item">
                    <img border="0" width="25" height="25" src="assets/images/objects/nuevo/{{car.icon}}" style="display:inline-block;margin:2px 0 2px 2px">
                    <label>{{car.name}}</label>
                  </div>
              </ng-template>
            </p-listbox>
          </div>

        </div>
      </div>
  </div>
    <ng-template pTemplate="footer">
      <div class="">
        <p-button icon="pi pi-times" (click)="displayEditGroup=false" label="Cancelar"></p-button>
        <p-button icon="pi pi-check" (click)="onConfirmationEdit()" label="Guardar" class="p-button-text"></p-button>
      </div>
        </ng-template>
</p-dialog>
<div class="col" id="rowBusqueda">
  <div class="row" style="margin-right: 0px; margin-left: 15px;">
    <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8" style="padding-left: 0px; padding-right: 0px;">
      <input (keyup)="onQuickFilterChanged($event)" type="text" ng-model="something.terms" placeholder="Buscar..." class="form-control ng-pristine ng-untouched ng-valid ng-empty" ng-change="something.search()" aria-invalid="false" style="">
    </div>
    <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2" style="padding-left: 0px; padding-right: 0px;">
      <button (click)="onClickGroup()" type="button" class="btn btn-primary">
        <i class="fa fa-plus"></i>
      </button>
    </div>
    <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-right" style="padding-left: 0px; padding-right: 0px;">
      <div ngbDropdown container="body">
        <button class="btn btn-primary" ngbDropdownToggle>
          <i class="fa fa-fw fa-sliders fa-1"></i>
        </button>
        <div ngbDropdownMenu>
          <div class="container">
            <!-- <button ngbDropdownItem>Personalizar Panel</button> -->
            <label>
              Personalizar Panel
            </label>
            <div class="dropdown-divider"></div>
            <div class="">
              <input (click)="onClickSetting('eye')" style="padding: 5px" type="checkbox" name="" value="" checked>
              <label for="">Ver</label>
            </div>
            <div class="">
              <input (click)="onClickSetting('imei')" style="padding: 5px" type="checkbox" name="" value="">
              <label for="">IMEI</label>
            </div>
            <div class="">
              <input (click)="onClickSetting('vehicle')" type="checkbox" name="" value="" checked>
              <label for="">Vehículos</label>
            </div>
            <div class="">
              <input (click)="onClickSetting('tag')" type="checkbox" name="" value="" checked>
              <label for="">Mostrar nombre</label>
            </div>
            <div class="">
              <input (click)="onClickSetting('follow')" type="checkbox" name="" value="" checked>
              <label for="">Seguir Vehículo</label>
            </div>
            <div class="">
              <input (click)="onClickSetting('limit')" type="checkbox" name="" value="" checked>
              <label for="">Limite de velocidad</label>
            </div>
            <div class="">
              <input (click)="onClickSetting('gps')" type="checkbox" name="" value="" checked>
              <label for="">GPS</label>
            </div>
            <div class="">
              <input (click)="onClickSetting('gsm')" type="checkbox" name="" value="" checked>
              <label for="">GSM</label>
            </div>
            <div class="">
              <input (click)="onClickSetting('trans')" type="checkbox" name="" value="" checked>
              <label for="">Transmisión</label>
            </div>
            <div class="">
              <input (click)="onClickSetting('config')" type="checkbox" name="" value="" checked>
              <label for="">Configurar</label>
            </div>
            <!-- <div class="">
              <input type="checkbox" name="" value="">
              <label for="">Recorrido</label>
            </div>
            <div class="">
              <input type="checkbox" name="" value="">
              <label for="">Localización</label>
            </div> -->
          </div>

        </div>
      </div>
    </div>
  </div>
</div>
<div class="">
  <p-treeTable #tt [value]="vehicles" [loading]="loading" [resizableColumns]="true" [reorderableColumns]="true" [columns]="cols" [scrollable]="true" scrollHeight="480px" styleClass="p-treetable-sm" sortField="name" [sortOrder]="sortOrder">
    <!-- <ng-template pTemplate="caption">
      <div style="text-align: right">
        <i class="pi pi-search" style="margin:4px 4px 0 0"></i>
        <input type="text" pInputText size="20" placeholder="Buscar ..." (input)="globalFilter($event)" style="width:auto">
      </div>
    </ng-template> -->
    <ng-template pTemplate="colgroup" let-columns>
      <colgroup>
        <!-- <col *ngFor="let col of columns" style="width:100px"> -->
        <col style="width:7px" *ngIf="setting['eye']">
        <col style="width:18px" *ngIf="setting['vehicle']">
        <col style="width:18px" *ngIf="setting['imei']">
        <col style="width:5px" *ngIf="setting['tag']">
        <col style="width:5px" *ngIf="setting['follow']">
        <col style="width:5px" *ngIf="setting['limit']">
        <col style="width:5px" *ngIf="setting['gps']">
        <col style="width:5px" *ngIf="setting['gsm']">
        <col style="width:5px" *ngIf="setting['trans']">
        <col style="width:5px" *ngIf="setting['config']">
      </colgroup>
    </ng-template>
    <ng-template pTemplate="header" let-columns>

      <tr>
        <th *ngIf="setting['eye']"><app-eye-header></app-eye-header></th>
        <th *ngIf="setting['vehicle']"><app-vehicle-header (sort)="onSort($event)" ></app-vehicle-header></th>
        <th *ngIf="setting['imei']" >IMEI</th>
        <th *ngIf="setting['tag']" ><app-tag-header></app-tag-header></th>
        <th *ngIf="setting['follow']" ><app-follow-header></app-follow-header></th>
        <th *ngIf="setting['limit']" ><app-limit-header></app-limit-header></th>
        <th *ngIf="setting['gps']" ><app-gps-header></app-gps-header></th>
        <th *ngIf="setting['gsm']" ><app-gsm-header></app-gsm-header></th>
        <th *ngIf="setting['trans']"><app-transmission-header></app-transmission-header></th>
        <th *ngIf="setting['config']" ><app-setting-header></app-setting-header></th>

      </tr>
      <!-- <th *ngFor="let col of columns" [ttSortableColumn]="col.field">
        {{col.header}}
        <p-treeTableSortIcon [field]="col.field"></p-treeTableSortIcon>
      </th> -->
    </ng-template>
    <ng-template pTemplate="body" let-rowNode let-rowData="rowData" let-columns="columns">
      <!-- <tr>
        <td *ngFor="let col of columns; let i = index" [attr.colspan]="columns.length">
          <div class="">
            <p-treeTableToggler [rowNode]="rowNode" *ngIf="i == 0"></p-treeTableToggler>
            {{rowData[col.field]}}->{{columns.length}}
          </div>
        </td>
      </tr> -->
      <tr *ngIf="rowData['col']==3">
        <td [attr.colspan]="column" style="padding: 0rem 0rem; font-weight: bold; color: #1F67A6;">
          <div class="row">
            <div class="col-9">
              <p-treeTableToggler [rowNode]="rowNode" ></p-treeTableToggler>
              {{rowData["name"]}}

            </div>
            <div *ngIf="rowData['name']!='Unidades Sin Convoy'&&rowData['name']!='Unidades Sin Grupo'" class="col-1">
              <span (click)="showDelete(rowData)" class="btn-label" title="Descomponer {{rowData['type']}}" data-bs-toggle="tooltip" data-bs-placement="top">
                <i class="fa fa-times" style="color:red"></i>
              </span>

            </div>
            <div *ngIf="rowData['name']!='Unidades Sin Convoy'&&rowData['name']!='Unidades Sin Grupo'" class="col-1">
              <span (click)="showEditGroup(rowData)" class="btn-label" title="Editar {{rowData['type']}}" data-bs-toggle="tooltip" data-bs-placement="top">
                <i class="fa fa-edit" style="color:#1F67A6"></i>
              </span>

            </div>
            <div class="col-1">

            </div>
          </div>
        </td>
      </tr>
      <tr *ngIf="rowData['col']!=3">
        <td *ngIf="setting['eye']" style="padding: 0rem 0rem;">
          <!-- <span class="btn-label"><i class="fa fa-eye-slash" style="color:#444444;"></i></span> -->
          <!-- <p-treeTableToggler [rowNode]="rowNode" ></p-treeTableToggler> -->
          <div *ngIf="rowData['eye'] == true" class="" style="font-size: 14px; text-align: center;">
            <span (click)="onClickEye(rowData['IMEI'])" class="btn-label"><i class="fas fa-eye" style="color:#444444;"></i></span>
          </div>
          <div *ngIf="rowData['eye'] == false" class="" style="font-size: 14px; text-align: center;">
            <span (click)="onClickEye(rowData['IMEI'])" class="btn-label"><i class="fa fa-eye-slash" style="color:#444444;"></i></span>
          </div>
          <!-- <span class="btn-label"><i class="fa fa-eye" style="color:#444444;"></i></span> -->
        </td>
        <td *ngIf="setting['vehicle']" style="padding: 0rem 0rem;">
          <div class="row">
            <div class="col-3">
              <img class="izquierda" (click)="onClickIcon(rowData['IMEI'])" border="0" width="25" height="25" src="assets/images/objects/nuevo/{{ rowData['icon'] }}">
            </div>
            <div class="col-9">
              <aside class="">
                {{rowData['name']}} <br>
                <small>
                  {{rowData['dt_tracker']}}
                </small>
              </aside>
            </div>
          </div>
        </td>
        <td *ngIf="setting['imei']" style="padding: 0rem 0rem;">
          {{rowData['IMEI']}}
        </td>
        <td *ngIf="setting['tag']" style="padding: 0rem 0rem;">
          <input type="checkbox" name="" value="" checked>
        </td>
        <td *ngIf="setting['follow']" style="padding: 0rem 0rem;">
          <span  class="btn-label" title="Seguir vehículo">
            <i class="fas fa-crosshairs" style="color:#444444; font-size: 14px;"></i>
          </span>
        </td>
        <td *ngIf="setting['limit']" style="padding: 0rem 0rem;">
          {{rowData['speed']}}
        </td>
        <td *ngIf="setting['gps']" style="padding: 0rem 0rem;">
          <span class="btn-label"><i class="fa fa-wifi"></i></span>
        </td>
        <td *ngIf="setting['gsm']" style="padding: 0rem 0rem;">
          <span class="btn-label"><i class="fa fa-wifi"></i></span>
        </td>
        <td *ngIf="setting['trans']" style="padding: 0rem 0rem;">
          <span class="btn-label">
            <i class="fa fa-circle" style="color:{{color[rowData['point_color']]}}"></i>
            <!-- <i class="fa fa-circle" style="color:black"></i> -->
          </span>
        </td>
        <td *ngIf="setting['config']" style="padding: 0rem 0rem;">
          <i (click)="onClickConfig(rowData)" class="fa fa-wrench" style="color:#444444"></i>
        </td>
      </tr>
    </ng-template>
  </p-treeTable>
</div>
